<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>单例模式</title>
  </head>
  <body>
    <button id="loginBtn" style="height: 36px; width: 46px">按钮</button>
    <script>
      // 单例模式：保证一个类仅有一个实例，并提供一个访问它的全局访问点。
      var createLogin = function () {
        var div = document.createElement('div')
        div.innerHTML = '我是登录的弹窗'
        div.style.display = 'none'
        document.body.appendChild(div)
        return div
      }

      var getElement = function (fn) {
        var result
        return function () {
          // return result || (result = fn.apply(this, arguments))
          return result || (result = fn())
        }
      }

      var create = getElement(createLogin)

      document.getElementById('loginBtn').onclick = function () {
        var loginLay = create()
        loginLay.style.display = 'block'
      }

      //////////////////////////////////////////////////////////////////////////////////////////////////////
      // ES6实现单例 如果在一个方法前加上static关键字,就表示该方法不会被实例继承,而是直接通过类来调用,这就称为静态方法。
      class SingletonApple {
        constructor(name, creator, products) {
          this.name = name
          this.creator = creator
          this.products = products
        }

        static getInstance(name, creator, products) {
          if (!this.instance) {
            this.instance = new SingletonApple(name, creator, products)
          }
          return this.instance
        }
      }

      let appleCompany = SingletonApple.getInstance('苹果公司', '乔布斯', [
        'iphone6',
        'iPad',
        'iMac',
      ])

      let shanZhaiCompany = SingletonApple.getInstance('苹果公司', '莆田', [
        'iphone6',
        'iPad',
        'iMac',
      ])

      console.log(appleCompany === shanZhaiCompany) //true
      //////////////////////////////////////////////////////////////////////////////////////
      function fn() {
        var arr = []
        for (var i = 0; i < 10; i++) {
          arr[i] = function () {
            return i
          }
        }
        return arr
      }
      var arr = fn()
      console.log(arr[0]()) //10  i访问的是循环的结束,想要得到0，将任意一个var -> let或者 见下代码
      // 没出现es6 let 使用闭包(立即执行函数，自调用函数)来解决 
      function fn1() {
        var arr = []
        for (var i = 0; i < 10; i++) {
          ;(function (i) {
            arr[i] = function () {
              return i
            }
          })(i)
        }
        return arr
      }
      var arr = fn1()
      console.log(arr[0]());
    </script>
  </body>
</html>
